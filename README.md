# Video Understanding Agent

AI-powered tooling that combines a Rich-powered command-line experience with a multi-view Flet desktop app to analyze, summarize, and interrogate video content using Google's **Gemini 3 Pro** family of multimodal models.

## Features

- **Video Summaries**: Produce concise, timestamped overviews of long-form videos.
- **Interactive Q&A**: Ask follow-up questions about visual or audio details.
- **Event Detection**: Highlight key moments with precise time offsets.
- **Transcription & Diarization**: Generate speaker-separated transcripts for spoken content.
- **Usage Insights**: Track token consumption, execution time, and estimated cost for every run.
- **Desktop UI**: Drag-and-drop videos, switch between Summarize, Chat, Events, and Transcribe views, and save results from a single window.
- **Config & Output Automation**: Load defaults from `config.yaml` and auto-name Markdown outputs when targeting directories.

## Prerequisites

- Python 3.12 or later
- [uv](https://github.com/astral-sh/uv) for dependency management
- Google Cloud API key with access to Gemini models

## Quick Start

1. **Clone the repository**
   ```bash
   git clone https://github.com/txnguyen292/video_analysis_agent.git
   cd video_analysis_agent
   ```

2. **Install dependencies**
   ```bash
   uv sync
   ```

3. **Configure credentials**
   ```bash
   touch .env
   echo "GOOGLE_API_KEY=your_api_key_here" >> .env
   ```

## Running The CLI

Use the `video-agent` script that is registered in `pyproject.toml`:

```bash
uv run video-agent [COMMAND] [OPTIONS]
```

- Summarize a video
  ```bash
  uv run video-agent summarize data/inputs/sample.mp4
  ```
- Ask a question about a scene
  ```bash
  uv run video-agent ask data/inputs/sample.mp4 "What is the presenter writing on the board?"
  ```
- Detect pivotal events
  ```bash
  uv run video-agent events data/inputs/sample.mp4
  ```
- Transcribe with diarization
  ```bash
  uv run video-agent transcribe data/inputs/sample.mp4
  ```

### Common Options

- `--model` / `-m` — Override the Gemini model ID (defaults to `gemini-3-pro`). Friendly names map to preview IDs for you.
- `--output` / `-o` — Save results to a directory or explicit file path. Directories yield auto-named Markdown files based on the video stem.
- `--config` / `-c` — Provide an alternate YAML config file (defaults to `config.yaml`).

## Launching The Desktop UI

The desktop experience reuses the same agent logic under the hood and surfaces four task-specific views.

- Launch with the packaged entry point (recommended):
  ```bash
  uv run video-agent-ui
  ```
- Enable hot reloading during development:
  ```bash
  uv run flet run src/video_agent/ui/app.py
  ```

Within the app you can drag videos onto the canvas, view progress feedback, inspect Markdown results, and save outputs to any local path.

## Configuration

Provide defaults in `config.yaml` so repetitive arguments are no longer required:

```yaml
video_path: "data/inputs/talk.mp4"
model: "gemini-3-pro"
output: "data/outputs/"  # resolves to data/outputs/talk.md
question: "What are the three main takeaways?"
```

With a config in place the following is enough to process a video:

```bash
uv run video-agent summarize
```

### Smart Output Resolution

When `--output` (or the config value) targets a directory, the agent saves a Markdown file named after the input video. For example, running `uv run video-agent summarize data/inputs/session.mp4 -o data/outputs/` creates `data/outputs/session.md`.

## Project Structure

```text
video_analysis_agent/
├── config.yaml            # Optional runtime defaults
├── data/
│   ├── inputs/            # Source videos for local testing
│   └── outputs/           # Markdown results generated by the agent
├── docs/
│   ├── ui_architecture.md # UI architecture notes
│   └── walkthrough.md     # CLI and agent walkthrough
├── pyproject.toml         # uv-managed dependencies and scripts
├── src/
│   └── video_agent/
│       ├── __init__.py
│       ├── agent.py       # High-level Gemini prompt orchestration
│       ├── client.py      # Gemini Files API client wrapper
│       ├── main.py        # Typer CLI entry point
│       ├── usage.py       # Token usage & cost utilities
│       └── ui/
│           ├── app.py     # Flet application bootstrap
│           ├── layout.py  # Navigation rail and view routing
│           ├── agent_helper.py
│           ├── components/
│           ├── storage/
│           │   ├── data/
│           │   └── temp/
│           └── views/
│               ├── chat.py
│               ├── events.py
│               ├── settings.py
│               ├── summarize.py
│               └── transcribe.py
└── tests/                 # Pytest suite placeholder
```

## Additional Resources

- Read the UI deep dive in [docs/ui_architecture.md](docs/ui_architecture.md).
- Follow the end-to-end CLI walkthrough in [docs/walkthrough.md](docs/walkthrough.md).

